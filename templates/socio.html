<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prelude Golden Christmas 2025 ‚Äî S√≥cio</title>

  <link rel="stylesheet" href="/static/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Libre+Baskerville&display=swap" rel="stylesheet">

  <meta name="description" content="Prelude Golden Christmas 2025 ‚Äî acesso exclusivo para s√≥cios." />

  <style>
    .invite-box {
      margin-top: 1.5em;
      padding: 1.5em;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      max-width: 420px;
      display: none; /* come√ßa escondido */
    }

    .invite-box h3 {
      color: var(--gold-light);
      font-size: 1.2rem;
      margin-bottom: 1em;
    }

    .invite-box form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .invite-box input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 4px;
      background: rgba(255,255,255,0.08);
      color: var(--white);
    }

    .invite-box button {
      margin-top: 0.6em;
      background-color: var(--gold);
      color: #111;
      border: none;
      padding: 12px 0;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .invite-box button:hover {
      background-color: var(--gold-light);
      transform: scale(1.02);
    }

    .msg-status {
      margin-top: 1em;
      font-size: 0.9rem;
      color: var(--gold-light);
    }

    .toggle-form {
      color: var(--gold);
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>

<body class="page-socio">
  <section class="hero">
    <div class="content">
      <h1 class="title">Prelude</h1>
      <h2 class="subtitle">Golden Christmas 2025</h2>

      <p>
        Seu nome est√° na lista como <strong>S√≥cio</strong>.<br />
        <span id="convites-info">Carregando convites dispon√≠veis...</span>
      </p>

      <p>
        <strong>Save the Date</strong><br />
        20 de dezembro de 2025 ‚Äî 20h<br />
        No cen√°rio mais especial que a Prelude j√° escolheu.
      </p>

      <p>
        As informa√ß√µes ser√£o enviadas pelo WhatsApp,<br />
        com c√≥digos de acesso e o link de compra.<br />
        Todas as confirma√ß√µes ser√£o feitas por esse canal.
      </p>

      <!-- ‚úÖ Texto atualizado -->
      <p>
        Para indicar seus convidados, <span class="toggle-form">me passe aqui que eu convido para voc√™</span>.
      </p>

      <div class="invite-box" id="inviteBox">
        <h3>Adicionar convidado</h3>
        <form id="formConvidar">
          <input type="text" id="nome" placeholder="Nome completo" required />
          <input type="text" id="apelido" placeholder="Como gosta de ser chamado" />
          <input type="text" id="whatsapp" placeholder="WhatsApp" required />
          <input type="email" id="email" placeholder="E-mail (opcional)" />
          <button type="submit">Enviar</button>
        </form>
        <div class="msg-status" id="msgStatus"></div>
      </div>

      <p><a href="/" class="link-voltar">Verificar outro nome</a></p>
    </div>
  </section>

  <footer class="footer-credit">
    Prelude Golden Christmas 2025 ‚Ä¢ S√≥cios
  </footer>

  <script>
    const socioId = localStorage.getItem("socio_id");
    const convitesInfo = document.getElementById("convites-info");
    const form = document.getElementById("formConvidar");
    const msgStatus = document.getElementById("msgStatus");
    const inviteBox = document.getElementById("inviteBox");
    const toggleForm = document.querySelector(".toggle-form");

    toggleForm.addEventListener("click", () => {
      inviteBox.style.display =
        inviteBox.style.display === "none" || inviteBox.style.display === ""
          ? "block"
          : "none";
    });

    async function carregarSocio() {
      if (!socioId) {
        convitesInfo.textContent = "Erro: ID do s√≥cio n√£o encontrado.";
        return;
      }

      try {
        const resp = await fetch(`/api/socio/${socioId}`);
        const data = await resp.json();

        if (data.erro) {
          convitesInfo.textContent = data.erro;
        } else if (data.convites_disponiveis === null || data.convites_disponiveis <= 0) {
          convitesInfo.textContent = "Voc√™ j√° usou todos os convites dispon√≠veis.";
        } else {
          convitesInfo.textContent = `Voc√™ tem acesso garantido e direito a indicar ${data.convites_disponiveis} amigo(s).`;
        }
      } catch (e) {
        convitesInfo.textContent = "Erro ao carregar dados.";
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msgStatus.textContent = "Enviando convite...";

      const payload = {
        nome: document.getElementById("nome").value,
        apelido: document.getElementById("apelido").value,
        whatsapp: document.getElementById("whatsapp").value,
        email: document.getElementById("email").value,
        quem_indicou: socioId
      };

      try {
        const resp = await fetch("/api/convidar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await resp.json();

        if (data.ok) {
          msgStatus.textContent = "Pode deixar ‚Äî eu vou convid√°-lo em seu nome üí´";
          form.reset();
          carregarSocio(); // atualiza convites dispon√≠veis
        } else {
          msgStatus.textContent = data.erro || "Erro ao cadastrar convidado.";
        }
      } catch {
        msgStatus.textContent = "Erro de conex√£o. Tente novamente.";
      }
    });

    carregarSocio();
  </script>
</body>
</html>
